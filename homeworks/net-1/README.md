1. Необязательное задание:
можно посмотреть целый фильм в консоли `telnet towel.blinkenlights.nl` :)

```
telnet towel.blinkenlights.nl 
Trying 213.136.8.188...
Trying 213.136.8.188...
Trying 213.136.8.188...
```

Похоже с узлом что-то не так

2. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.

Непересекающимися в 2.4 ГГц являются 3 канала – это каналы (для 20 МГц): 1, 6 и 11, (для 40 МГц): 3 и 11, Для 5 ГГц доступно 23 неперекрывающихся канала из 20 МГц. Еще можно использовать ширину 20/40 МГц  и широкий канал в 80 МГц основной и вспомогательный.

3. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?

Apple, Inc. 1 Infinite Loop Cupertino CA 95014 US

4. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?

Payload TCP = TCP MSS = 9001-20-32=8949 байт.

5. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?

В обычном, штатном режиме не могут в TCP не могут одновременно быть установлены флаги SYN и FIN, т.к. это взаимоисключающие состояния соединения TCP. Это запросы на установление соединения и запрос на закрытие соединения.

6. `ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```

Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?


Эта команда отображает все прослушиваемые UDP сокеты в системе, которые отфильтрованы по source port UDP 53. 

TIME-WAIT в State у UDP присутствовать не может, т.к. у UDP нет процедуры завершения соединения.

Состояние UNCONN говорит, что нет активной передачи данных т.е. peer address отсутствует.


7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.

Инициатор, отправив FIN, переходит из состояния ESTABLISHED в состояние FIN-WAIT-1. Ответчик, получив FIN от инициатора, отправляет ACK в ответ инициатору, переходя из состояния ESTABLISHED в состояние CLOSE-WAIT. Инициатор, получив ACK от ответчика, переходит с FIN-WAIT-1 на FIN-WAIT-2. Теперь ответчик, со своей стороны, отправляет FIN инициатору, переходя от CLOSE-WAIT к LAST-ACK. Инициатор, получив FIN от ответчика, переходит от FIN-WAIT-2 к TIME-WAIT и отправляет последний ACK ответчику. После этого инициатор и ответчик переходят в состояние ЗАКРЫТО.

8. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?

Максимальное количество подключений, ограниченное только параметрами L4, которое клиент может установить параллельно с одного IP-адреса на сервер с одним IP-адресом, составляет 65535. Точно так же сервер может обслуживать до 65535 подключений от одного клиента (с одного IP-адреса). клиент). Если имеется более одного клиента, сервер уже может обслуживать более 65535 соединений. они будут запускаться с разных IP-клиентов. И здесь сервер ограничен подключениями только своими ресурсами ЦП / ОЗУ.

9.  Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT`? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.

Ситуация маловероятна, т.к. это предпоследнее состояние инициатора при завершении соединения TCP, переходящее затем в CLOSED после определенного времени без ожидания получения каких-либо других подтверждений от ответчика. 

Если такая ситуация произошла бы, то не освобождался бы source/destination сокет на инициаторе, а после этого инициатор смог бы установить меньшее число новых подключений TCP из-за неосвобожденных сокетов TIME-WAIT.

10.  Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

На уровне IP при сборке фрагментированных пакетов для UDP мог и не собраться исходный пакет IP, из-за негарантированной доставки у UDP. У UDP начинает страдать скорость при его фрагментации на IP уровне. И весь смысл использования быстрого UDP теряется. Лучше не использовать большие датаграммы UDP, чтобы не пришлось их фрагментировать на уровне IP.

11.  Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.

```
TCP для гарантированной доставки получения логов. syslog работает на UDP/514 так как важна скорость доставки и небольшие размеры UDP. Скорее всего клиент и сервер syslog на прикладном уровне сами обеспечивают гарантированную доставку текстовых логов или она не настолько важна.
```

12. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?

```
$ ss -tle
State    Recv-Q   Send-Q       Local Address:Port         Peer Address:Port   Process                        
LISTEN   0        4096               0.0.0.0:8200              0.0.0.0:*       ino:23964 sk:1 <->            
LISTEN   0        4096               0.0.0.0:sunrpc            0.0.0.0:*       ino:15747 sk:2 <->            
LISTEN   0        4096         127.0.0.53%lo:domain            0.0.0.0:*       uid:101 ino:22535 sk:3 <->    
LISTEN   0        128                0.0.0.0:ssh               0.0.0.0:*       ino:25579 sk:4 <->            
LISTEN   0        4096                     *:8201                    *:*       ino:24026 sk:5 v6only:0 <->   
LISTEN   0        4096                  [::]:sunrpc               [::]:*       ino:15751 sk:6 v6only:1 <->   
LISTEN   0        128                   [::]:ssh                  [::]:*       ino:25590 sk:7 v6only:1 <-> 

$ sudo lsof -ni :domain
COMMAND   PID            USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
systemd-r 612 systemd-resolve   12u  IPv4  22534      0t0  UDP 127.0.0.53:domain 
systemd-r 612 systemd-resolve   13u  IPv4  22535      0t0  TCP 127.0.0.53:domain (LISTEN)

$ sudo lsof -ni :ssh
COMMAND  PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
sshd    1948    root    3u  IPv4  25579      0t0  TCP *:ssh (LISTEN)
sshd    1948    root    4u  IPv6  25590      0t0  TCP *:ssh (LISTEN)
sshd    8903    root    4u  IPv4  35952      0t0  TCP 10.0.2.15:ssh->10.0.2.2:60938 (ESTABLISHED)
sshd    9094 vagrant    4u  IPv4  35952      0t0  TCP 10.0.2.15:ssh->10.0.2.2:60938 (ESTABLISHED)

$ sudo lsof -ni :8200
COMMAND PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
vault   669 root    8u  IPv4  23964      0t0  TCP *:8200 (LISTEN)

$ sudo lsof -ni :sunrpc
COMMAND PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
systemd   1 root   35u  IPv4  15747      0t0  TCP *:sunrpc (LISTEN)
systemd   1 root   36u  IPv4  15748      0t0  UDP *:sunrpc 
systemd   1 root   37u  IPv6  15751      0t0  TCP *:sunrpc (LISTEN)
systemd   1 root   38u  IPv6  15754      0t0  UDP *:sunrpc 
rpcbind 611 _rpc    4u  IPv4  15747      0t0  TCP *:sunrpc (LISTEN)
rpcbind 611 _rpc    5u  IPv4  15748      0t0  UDP *:sunrpc 
rpcbind 611 _rpc    6u  IPv6  15751      0t0  TCP *:sunrpc (LISTEN)
rpcbind 611 _rpc    7u  IPv6  15754      0t0  UDP *:sunrpc 

$ sudo lsof -ni :8201
COMMAND PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
vault   669 root    9u  IPv6  24026      0t0  TCP *:8201 (LISTEN)
```

13. Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?

Ключ -A для вывода содержимого фреймов в текстовом виде. Ключ -X или -XX для текстового и шестнадцатиричного.

14. Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?

Встретились флаги IPv4 0x40 Don't fragment, запрещающие разбивать IP пакет на фрагменты при отправке. Всего имеется 3 бита флагов IPv4. Нулевой бит зарезервирован и всегда должен быть нулевым. 

Если значение первого бита равно нулю, то фрагментация пакетов разрешена, если один (бит DF или Do not Fragment), то устройства компьютерной сети не будут выполнять фрагментацию.

Второй бит используется для того, чтобы конечные узлы понимали, где последовательность фрагментированных пакетов начинается и где она заканчивается, если значение этого бита равно единице (MF More Fragments), то узел понимает, что этот пакет не последний и необходимо дождаться дополнительных пакетов для создания изначально разделенного пакета. 

Стандарт Ethernet называется IEEE 802.3, обозначающий проводной Ethernet. В дампе практически везде MAC адреса отправителя и получателя идут с расшифрованной информацией производителя OUI, да - можно.
